{% extends ":template:home.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('frontend/css/homepage.css') }}">
    <link rel="stylesheet" href="{{ asset('frontend/externres/node_modules/@material/button/dist/mdc.button.css') }}">
    <link rel="stylesheet" href="{{ asset('frontend/externres/node_modules/@material/dialog/dist/mdc.dialog.css') }}">
    <link rel="stylesheet" href="{{ asset('frontend/css/map-dialog.css') }}">
    <link rel="stylesheet" href="{{ asset('frontend/externres/seiyria-bootstrap-slider/dist/css/bootstrap-slider.min.css') }}">

{% endblock %}

{% block body %}
    <section  class="parallax-window" id="home" data-parallax="scroll" data-image-src="{{ asset('frontend/img/test-imgs/vegan-cover.jpg') }}" data-natural-width="1400" data-natural-height="550">
        <div id="subheader">
            <div id="sub_content">
                <h1>Commander Votre repas a partir de <strong id="js-rotating">Restaurant,Snack,Boulangerie</strong> <!--Food--></h1>
                <button type="button" class="search-btn btn" id="nav-search">Chercher Maintenant le plus proshe de toi ! </button>
            </div><!-- End sub_content -->
        </div><!-- End subheader -->
    </section><!-- End section -->
    <div class="container margin_60">

        <div class="row">
            <div class="col-md-3">
                <div class="box_home" id="one">
                    <span>1</span>
                    <h3>Recherche par address<!--Search by address--></h3>
                    <p>
                        Trouver les restaurants disponible dans la zone souhaité.
                    </p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="box_home" id="two">
                    <span>2</span>
                    <h3>Choisir un restaurant</h3>
                    <p>
                        We have more than 1000s of menus online.
                    </p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="box_home" id="three">
                    <span>3</span>
                    <h3>Paiment de la commande</h3>
                    <p>
                        Payer votre commande en ligne en toutes securité.
                    </p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="box_home" id="four">
                    <span>4</span>
                    <h3>Livraison a votre adresse</h3>
                    <p>
                        Ivraison de votre commande a votre emplacment
                    </p>
                </div>
            </div>
        </div><!-- End row -->


    </div><!-- End container -->

    <div class="white_bg" id="resto-search-block">
        <div class="container margin_60" >

            <div class="main_title">
                <h2 class="nomargin_top searchrestotitle"><span>Choisire le plus proche de toi</span><!---Choose from Most Popular--></h2>
                <p>
                    Choisire le restaurant ,le snack ou la blongerie le plus proche de votre localistion ou votre adresse.
                </p>
            </div>
            <div class="row" >
                <div class="btns-location">
                    <form  method="post" action="{{ path('client_homepage_getnearresto') }}">
                        <input type="hidden" id="user-lat" name="latu" value="">
                        <input type="hidden" id="user-long" name="longu" value="">
                        <input type="hidden" id="user-rad" name="radu" value="10">
                    <button type="button"  class="btn-loc" id="search-loc">Votre localistaion</button>
                    <button type="button" class="btn-loc" id="search-adr" >Votre adresse</button>
                    </form>
                </div>

                <div  id="load">
                    <h4>Recherche en cour...</h4>
                    <img  src="{{ asset('frontend/img/loadimg3.gif') }}">
                </div>
               <div  id="resto-block">
                 <div class="col-md-12 adresse-block">
                       <span style="display: inline-block">Votre adresse :</span>
                       <input type="text" class="customer-adr" id="cadr" disabled value="09 rue independence ariana" >
                       <button class="change-adr" id="upd-adr" >Modifier</button>
                       <div class="radius-block">
                       <span  >Diametre en Km :</span>
                        <input style="display: inline-block" id="radius-val" data-slider-id='slider-radius'  type="text" data-slider-handle="custom" data-slider-min="0"  data-slider-max="10" data-slider-step=".1" data-slider-value="10"/>

                        </div>


                   </div>
                   <div id="listr">

                   </div>
              {#     {% for i in 1..5 %}
                    <div class="col-md-6">
                        <a href="detail_page.html" class="strip_list">
                            <div class="ribbon_1">Popular</div>
                            <div class="desc">
                                <div class="thumb_strip">
                                    <img src="{{ asset('frontend/img/thumb_restaurant.jpg') }}" alt="">
                                </div>
                                <div class="rating">
                                    <i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i>
                                </div>
                                <h3>Sushi Gold</h3>
                                <div class="type">
                                    Restaurant
                                </div>
                                <div class="location">
                                    135 rue independance, ariana, tunisie. <span class="closing">fermé maintenat</span>
                                </div>
                                <ul>
                                    <li><i class="icon_clock_alt ok"></i>ouverture</li>
                                    <li><i class="icon_clock_alt no"></i>fermeture</li>
                                </ul>
                            </div><!-- End desc-->
                        </a><!-- End strip_list-->

                   </div>
                   {% endfor %}  #}
                </div>
            </div>

<!-- End row -->

        </div><!-- End container -->
    </div><!-- End white_bg -->


    <section class="parallax-window ins-ad-block" data-parallax="scroll" data-image-src="{{ asset('frontend/img/bg_office.jpg') }}" data-natural-width="1200" data-natural-height="600">
        <div class="parallax-content" >
            <div class="sub_content">
                <i class="icon_mug" style="display:none;"></i>
                <h3 class="subscribe-add-title">Rejoindre HospEat et Benificer beaucoup d'avantages<!--We also deliver to your office--></h3>

                <ul>
                <li id="li1">
                   Chercher le plus proshe de toi.
                </li>
                    <li id="li2">
                        Choisir Votre Repas prefere.
                </li>
                    <li id="li3">
                    livraison chez vous.
                </li>
                </ul>
            </div><!-- End sub_content -->
            <div class="left-side"><button class="btn-subscribe btn">Inscription maintenant</button></div>
        </div><!-- End subheader -->

    </section><!-- End section -->
    <!-- End Content =============================================== -->
    <aside id="map-dialog"
           class="mdc-dialog"
           role="alertdialog"
           aria-labelledby="mdc-dialog-with-list-label"
           aria-describedby="mdc-dialog-with-list-description">
        <div class="mdc-dialog__surface map-dialog-block" >
            <div class="mdc-dialog__header">
                <h2 style="display: none" id="mdc-dialog-with-list-label" class="mdc-dialog__header__title">
                    Choose a Ringtone
                </h2>
            </div>
            <section id="mdc-dialog-with-list-description" class="mdc-dialog__body mdc-dialog__body--scrollable map-dialog-body">
                <ul class="mdc-list" style="display: none">
                    <li class="mdc-list-item">None</li>
                    <li class="mdc-list-item">Callisto</li>
                    <li class="mdc-list-item">Ganymede</li>
                    <li class="mdc-list-item">Luna</li>
                    <li class="mdc-list-item">Marimba</li>
                    <li class="mdc-list-item">Schwifty</li>
                    <li class="mdc-list-item">Callisto</li>
                    <li class="mdc-list-item">Ganymede</li>
                    <li class="mdc-list-item">Luna</li>
                    <li class="mdc-list-item">Marimba</li>
                    <li class="mdc-list-item">Schwifty</li>
                </ul>
                <div id="blockmap" class="container">
                    <div  style="width: 100%;">
                        <div class="pac-card" id="pac-card">
                            <div>
                                <div id="title">
                                    Recherche Restaurant
                                </div>

                            </div>
                            <div id="pac-container">
                                <input id="pac-input" type="text"
                                       placeholder="Rechercher votre restaurant">
                            </div>
                        </div>

                        <div id="map"></div>

                        <div id="infowindow-content">

                            <img src="{{ asset('frontend/img/location.png') }}" style="float: left" id="locimg" width="16" height="16">
                            <span id="place-address" class="pa"></span>

                        <input type="hidden" id="adrltd">
                        <input type="hidden" id="adrlng">
                        </div>
                    </div>

                </div>

            </section>
            <div class="mdc-dialog__footer">
                <button type="button" class="mdc-dialog__footer__button--cancel btn-dialog-cancel">Annuler</button>
                <button type="button" class="mdc-dialog__footer__button--accept btn-dialog-confirm" id="confb">Confirmer</button>
            </div>
        </div>
        <div class="mdc-dialog__backdrop"></div>
    </aside>



{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5uQXfyamglp8zZoBt50LyxaAePdzzpAc&libraries=places"
            async defer></script>
    <script src="{{ asset('frontend/externres/node_modules/@material/dialog/dist/mdc.dialog.js') }}" type="text/javascript"></script>

<script type="text/javascript" src="{{ asset('frontend/externres/seiyria-bootstrap-slider/dist/bootstrap-slider.js') }}"></script>

<script type="text/javascript" src="{{ asset('frontend/js/common_scripts_min.js') }}"></script>
<script type="text/javascript" src="{{ asset('frontend/js/functions.js') }}"></script>
<script type="text/javascript" src="{{ asset('frontend/js/morphext.min.js') }}"></script>

    <script>
        $("#js-rotating").Morphext({
            animation: "fadeIn", // Overrides default "bounceIn"
            separator: ",", // Overrides default ","
            speed: 2300, // Overrides default 2000
            complete: function () {
                // Overrides default empty function
            }
        });
    </script>
    <script type="text/javascript" src="{{ asset('frontend/js/homepage.js') }}"></script>
    <script>
        function setCookie(cname, cvalue) {
            document.cookie = cname + "=" + cvalue + ";"  + ";path=/";
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
            function rechajax(lat,long,rd) {
                height =  $('.main_title').height()+$('#load').height()    ;
                $('.btns-location').hide();
                $('#resto-search-block').height(height);
                $(window).resize();
                $('#load').show();
                var geocoder = new google.maps.Geocoder;
                $.ajax({
                    url:'{{ path('client_homepage_getnearresto') }}',
                    type: "POST",
                    data: {
                        "ltd": lat,
                        "lng": long,
                        "rad":rd
                    },
                    success : function (result) {
                        setCookie("ltd",lat);
                        setCookie("lng",long);
                        var latlng = {lat: parseFloat(lat), lng: parseFloat(long)};
                        geocoder.geocode({'location': latlng}, function(results, status) {
                            $('#cadr').val(results[0].formatted_address);
                        });


                        $('#listr').html(result);

                        $("#load").hide();
                        //height = $('#resto-search-block').height() + $('#resto-block').height() - $('#load').height() - $('.main_title').height();
                        height = $('#resto-block').height()+ $('.main_title').height();
                        $('#resto-search-block').height(height);
                        $(window).resize();
                        alert('height +resto lis' + $('#resto-search-block').height());
                        $('#resto-block').show();
                        alert('finish');



                    },
                     error: function(xhr){
                         alert('errrrrrro'+'Request Status: ' + xhr.status + ' Status Text: ' + xhr.statusText + ' ' + xhr.responseText);

                         },
                     //async: false
                });


            }
            $('#search-loc').click(function () {
            //var height = $('#resto-search-block').height() + $('#load').height() - $('.main_title').height();
                height =  $('.main_title').height()+$('#load').height()    ;
            $('.btns-location').hide();
            $('#resto-search-block').height(height);
            $(window).resize();
            $('#load').show();
            var geocoder = new google.maps.Geocoder;
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition( function suc (position) {
                    setCookie("ltd",position.coords.latitude);
                    setCookie("lng",position.coords.longitude);

                    $.ajax({
                        url:'{{ path('client_homepage_getnearresto') }}',
                        type: "POST",
                        data: {
                            "ltd": position.coords.latitude,
                            "lng": position.coords.longitude,
                            "rad":"10"
                        },
                        success : function (result) {
                            var latlng = {lat: parseFloat(position.coords.latitude), lng: parseFloat(position.coords.longitude)};
                            geocoder.geocode({'location': latlng}, function(results, status) {
                                $('#cadr').val(results[0].formatted_address);
                            });


                            $('#listr').html(result);

                                $("#load").hide();
                                //height = $('#resto-search-block').height() + $('#resto-block').height() - $('#load').height() - $('.main_title').height();
                            height = $('#resto-block').height()+ $('.main_title').height();
                            $('#resto-search-block').height(height);
                                $(window).resize();
                                alert('height +resto lis' + $('#resto-search-block').height());
                                $('#resto-block').show();
                                alert('finish');



                        },
                        // error: function(xhr){
                        //     alert('errrrrrro'+'Request Status: ' + xhr.status + ' Status Text: ' + xhr.statusText + ' ' + xhr.responseText);
                        //
                        //     },
                        // async: false
                    });

                }, function err (error) {
                    $('#load').hide();
                        alert('erreur' + error.code);


                    });

                }
            });
            $("#radius-val").on('slideStop',function () {
                height =  $('.main_title').height()+$('#load').height()    ;
                $('#resto-block').hide();
              //  alert('height'+height);
                $('#resto-search-block').height(height);
                $(window).resize();
                $('#load').show();

                $.ajax({
                    url:'{{ path('client_homepage_getnearresto') }}',
                    type: "POST",
                    data: {
                        "ltd": getCookie('ltd'),
                        "lng": getCookie('lng'),
                        "rad":$('#radius-val').val()
                    },
                    success : function (result) {
                        $('#listr').html(result);
                        $("#load").hide();
                         height = $('#resto-block').height()+ $('.main_title').height();
                        $('#resto-search-block').height(height);
                        $(window).resize();
                      // alert('height +resto lis in succ' + $('#resto-search-block').height()+"resto block h"+$('#resto-block').height()+"listr block h"+$('#listr').height()+"main title block h"+$('.main_title').height());
                       alert('adrees +resto lis in succ' + $('#resto-block').height());
                       alert( $('#resto-block').css('padding-bottom'));
                       alert(getCookie('ltd')+"      +    "+getCookie('lng'));
                        $('#resto-block').show();




                    },
                    error: function(xhr){
                         alert('errrrrrro'+'Request Status: ' + xhr.status + ' Status Text: ' + xhr.statusText + ' ' + xhr.responseText);

                        },
                    // async: false
                });

            });



    </script>
    <script>

        function initMap() {

            var input = document.getElementById('pac-input');
            var card = document.getElementById('pac-card');

            var map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: parseFloat(getCookie('ltd')), lng: parseFloat(getCookie('lng'))},
                zoom: 17,
                mapTypeControl: false,
                streetViewControl: false
            });

            var marker = new google.maps.Marker({
                map: map,
                anchorPoint: new google.maps.Point(0, -29),

            });
            var geocoder = new google.maps.Geocoder;
            var autocomplete = new google.maps.places.Autocomplete(input);

            loc(map,marker,geocoder,autocomplete,card);
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position){
                    var input = document.getElementById('pac-input');
                    var card = document.getElementById('pac-card');
                    var map = new google.maps.Map(document.getElementById('map'), {
                        center: {lat: position.coords.latitude, lng: position.coords.longitude},
                        zoom: 17,
                        mapTypeControl: false,
                        streetViewControl: false

                    });
                    var marker = new google.maps.Marker({
                        map: map,
                        anchorPoint: new google.maps.Point(0, -29),
                        position: {lat: position.coords.latitude, lng: position.coords.longitude}

                    });
                    var geocoder = new google.maps.Geocoder;
                    var autocomplete = new google.maps.places.Autocomplete(input);

                    loc(map,marker,geocoder,autocomplete,card);
                });


            }






        }
        function loc (map,marker,geocoder,autocomplete,card){

            var service = new google.maps.places.PlacesService(map);

            map.controls[google.maps.ControlPosition.TOP_LEFT].push(card);



            // Bind the map's bounds (viewport) property to the autocomplete object,
            // so that the autocomplete requests use the current map bounds for the
            // bounds option in the request.
            autocomplete.bindTo('bounds', map);

            var infowindow = new google.maps.InfoWindow();
            var infowindowContent = document.getElementById('infowindow-content');
            infowindow.setContent(infowindowContent);

            autocomplete.addListener('place_changed', function() {
                infowindow.close();
                marker.setVisible(false);
                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    // User entered the name of a Place that was not suggested and
                    // pressed the Enter key, or the Place Details request failed.
                    console.log("No details available for input: '" + place.name + "'");
                    return;
                }

                // If the place has a geometry, then present it on a map.
                if (place.geometry.viewport) {
                    map.fitBounds(place.geometry.viewport);
                } else {
                    map.setCenter(place.geometry.location);
                    map.setZoom(17);  // Why 17? Because it looks good.
                }
                marker.setPosition(place.geometry.location);
                marker.setVisible(true);

                var address = '';
                if (place.address_components) {
                    address = [
                        (place.address_components[0] && place.address_components[0].short_name || ''),
                        (place.address_components[1] && place.address_components[1].short_name || ''),
                        (place.address_components[2] && place.address_components[2].short_name || '')
                    ].join(' ');
                }
                infowindowContent.children['place-address'].textContent = address;
                infowindow.open(map, marker);
                $('#adrltd').val(place.geometry.location.lat());
                $('#adrlng').val(place.geometry.location.lng());

            });
            google.maps.event.addListener(map, 'click', function(evt) {
                evt.stop()
                if (evt.placeId) {
                    service.getDetails({
                        placeId: evt.placeId
                    }, function(place, status) {
                        if (status === google.maps.places.PlacesServiceStatus.OK) {

                            infowindowContent.children['place-address'].textContent = place.formatted_address;
                            infowindow.open(map, marker);
                            $('#adrltd').val(place.geometry.location.lat());
                            $('#adrlng').val(place.geometry.location.lng());

                        }

                    });
                }
                else {
                    setAdr(infowindowContent.children['place-address'],evt.latLng);
                    infowindow.open(map, marker);
                    $('#adrltd').val(getlng(evt.latLng.toString()));
                    $('#adrlng').val(getltd(evt.latLng.toString()));

                }

                marker.setPosition(evt.latLng);
                marker.setVisible(true);
            });
            function setAdr(adrwindow,latlng) {

                geocoder.geocode({'location': latlng}, function(results, status) {
                    if (status === 'OK') {
                        if (results[0]) {

                            adrwindow.textContent=results[0].formatted_address;

                        } else {
                            console.log('No results found');

                        }
                    } else {

                        console.log('Geocoder failed due to: ' + status);
                    }
                });
            }
            function displayLoc(pi,pn,pa,plat,plng)
            {

//alert("nom "+pn+"adress:  "+pa+"lat:  "+plat+"lng:   "+plng);
                $('#nom').val(pn);
                $('#adr').val(pa);
                $('#latr').val(plat);
                $('#langr').val(plng);
                /* $('#lang').text(plat);
                 $('#lat').text(plng);*/
                if(pi.length===0)
                { $('#idplacer').val(plat+","+plng);}
                else{ $('#idplacer').val(pi);}

            }
            function getlng(lng) {
                var newlng;
                newlng=lng.substring(1,lng.indexOf(","));
                return newlng;

            }
            function getltd(lng) {
                var newlng;
                newlng=lng.substring(lng.indexOf(",")+2,lng.indexOf(")")-1);
                return newlng;

            }
        }
        $('#search-adr').click(function () {
            initMap();
            var dialog = new mdc.dialog.MDCDialog(document.querySelector('#map-dialog'));
            dialog.show();
            dialog.listen('MDCDialog:accept', function() {
                // console.log('accepted');
                // $('#sucsess-box').css('display','block');
                alert($('#adrltd').val());
                rechajax($('#adrltd').val(),$('#adrlng').val(),'10');
            })
        });
        $('#upd-adr').click(function ()
        {
            height =  $('.main_title').height()+$('.btns-location').height()    ;
            $('#resto-block').hide();
            $('#resto-search-block').height(height);
            $(window).resize();
            $('.btns-location').show();
        });

    </script>

{% endblock %}

